Обнаружение и локализация объектов интереса
в видео – классическая задача компьютерного зрения. Несмотря на долгую историю развития методов обнаружения , ключевой подход к решению, называемый методом скользящего окна и
заключающийся в применении классификатора к
разным частям (окнам) изображения, остается
неизменным. Классификатор определяет, содержит ли рассматриваемая область изображения объект интереса или нет. Обычно рассматривают окна,
отличающиеся не только положением, но и размерами.
Количество таких окон может быть очень велико. Например, при поиске голов людей на изображении fullHD разрешения  (рис. 1)
алгоритм  классифицирует 1 310 859 окон. Их
обработка требует значительных вычислительных
ресурсов. Эта проблема существенно ограничивает
широкое применение алгоритмов видеоаналитики
на практике.
В то же время можно заметить, что в большинстве анализируемых окон размеры человека в
сцене неправдоподобны. Например, маловероятно
в сцене, представленной на рисунке 1, увидеть голову человека, занимающую половину изображения. Такие априорные знания могут существенно
сократить количество обрабатываемых окон и увеличить скорость обработки видеоданных. Для
этого необходимо разработать алгоритм классификации окон изображений на ложные и правдоподобные в зависимости от положения камеры. К сожалению, в настоящий момент для произвольной
сцены такого алгоритма фильтрации обнаружений
не существует.
В данной работе представлен алгоритм определения ложных срабатываний детектора головы человека, использующий информацию о наблюдаемой сцене. Авторы ограничиваются рассмотрением только простых сцен:
 камера снимает плоскую сцену, то есть
наблюдаемая поверхность земли является горизонтальной плоскостью;
 люди могут находиться только на поверхности земли;
 дисторсией камеры можно пренебречь.
Эти предположения существенно ограничивают набор рассматриваемых сцен. Так, сцена, содержащая лестницу, не подходит под описанные
ограничения. В то же время рассматриваемый
класс сцен является наиболее распространенным в
видеонаблюдении.
Основной вклад данной работы:
 предложен метод построения классификатора обнаружений на невозможные с геометрической точки зрения и правдоподобные;
 показан способ построения синтетической
выборки для обучения классификатора голов человека;
 показано, что построенный алгоритм классификации обнаружений позволяет повысить точность обнаружения голов людей;
 предложен способ интеграции классификатора обнаружений с используемым детектором голов, который позволил повысить скорость и точность обработки данных.
Смежные работы
Задача построения детектора объектов на изображении всегда интересовала исследователей в области компьютерного зрения. Обычно на разрабатываемые алгоритмы накладывались требования
по времени работы и количеству ложных срабатываний. Эти требования зачастую противоречили
друг другу. Действительно, часто повышение точности классификатора окон приводит к повышению его вычислительной сложности. Для практического применения в видеонаблюдении скорость
обработки данных является ключевым параметром,
поэтому многие разработчики стремились найти
способы понижения вычислительной сложности
детекторов при сохранении их качества. Можно
выделить два основных направления работы в этой
области: построение быстрого классификатора и
уменьшение количества рассматриваемых окон.
Первые работы по ускорению детектирования
посвящены ускорению применяемого классификатора. Авторы  предложили использовать каскад
простых классификаторов для детектирования лиц
на изображениях. Первые этапы каскада отбрасывают большое количество простых окон, не содержащих лиц. Предложенная идея оказалась
настолько эффективной, что каскадные детекторы
стали применяться даже в цифровых фотоаппаратах. Одним из важных недостатков такого подхода
является отсутствие возможности изменять соотношение точность/полнота для уже построенного
классификатора. Авторы работы  преодолели
это ограничение, изменив структуру каскада. Они
разделили построение простых классификаторов
на каждом этапе каскада и выбор границы для разделения положительных и отрицательных примеров. В  ускорение классификатора достигнуто за
счет вычисления признаков лишь на разреженной
пирамиде изображений. На промежуточных слоях
предложено восстанавливать признаки с помощью
интерполяции. В данной работе предложен алгоритм понижения вычислительной сложности детектора, который не зависит от типа используемого
классификатора окон, поэтому его можно использовать совместно с быстрыми классификаторами.
Другое направление по ускорению обнаружения на изображениях – уменьшение количества
рассматриваемых окон. Авторы работы  используют корреляцию откликов классификатора в
соседних окнах для выделения регионов изображения, где могут находиться объекты. Для этого разреженное множество окон классифицируют на первых этапах обработки. В связи с существенным
развитием нейросетевых алгоритмов классификации изображений  сверточные нейронные
сети стали применять и для задачи обнаружения
объектов на изображении. Обычно нейросетевые
классификаторы требуют больших вычислительных ресурсов, поэтому в работе  авторы
развили предыдущую идею и предложили разбить
классификатор на этапы классификации и уточнения положения объекта. Это позволило увеличить
размер окон и уменьшить их количество.
Предложенный в данной работе алгоритм может быть интегрирован с любым из методов уменьшения количества обрабатываемых окон, поскольку дает априорную оценку областей, где могут находиться объекты интереса.
Предложенный метод
В данной работе создан алгоритм классификации обнаружений детектора голов людей на корректные и невозможные с геометрической точки
зрения. Построенный алгоритм опирается на информацию о положении и параметрах камеры.
Важно отметить, что ключевым требованием к разработанному классификатору является инвариантность к классификатору окон, используемому
детектором. Это позволяет построить алгоритм
фильтрации обнаружений для любого детектора.
Формально входом алгоритма являются положение
камеры и признаки классифицируемого обнаружения. Под обнаружением понимается прямоугольник, ограничивающий изображение объекта,
найденного детектором.
Предложенный метод предусматривает три
этапа построения классификатора результатов детектора:
построение синтетической выборки изображений;
построение признаков обнаружений, инвариантных для синтетических и реальных данных;
обучение классификатора.
Рассмотрим подробнее каждый их этих этапов
для построения классификатора обнаружений детектора голов людей.
Построение обучающей выборки
Для обучения классификатора обнаружений
необходима обучающая выборка. Авторы не могли
использовать размеченные данные видеонаблюдения из-за сложности их сбора, поэтому с помощью
компьютерной графики построили синтетическую
выборку, моделирующую сценарий видеонаблюдения. Выборка состоит из 30 179 сцен, все они определяются положением камеры. Каждая сцена состоит из плоскости земли, стоящих на ней людей и
камеры. Использовалась упрощенная модель камеры, которая определяется углами наклона и поворота камеры, фокусным расстоянием и высотой
камеры над плоскостью земли. Для построения
каждой сцены параметры камеры выбирались случайным образом из равномерного распределения

Для моделирования людей в сцене использовались результаты работы . Каждая построенная
сцена содержит не менее 200 человек, размещенных в случайных положениях плоскости земли.
Извлечение признаков обнаружений
Обучение алгоритмов машинного обучения
только на синтетической выборке может привести
к эффекту переобучения, поэтому важным этапом
обработки является построение признаков, инвариантных к типу обрабатываемых данных. В качестве
таких признаков выбраны параметры ограничивающего прямоугольника, обнаруженного детектором. Для задачи фильтрации обнаружений головы
была использована оптимизированная версия детектора голов людей  из-за высокой скорости его
работы.
Модель  позволила исключить ложные обнаружения из обучающей выборки за счет информации о положении ключевых точек на человеке.
Построение классификатора
Формально задача классификации обнаружений ложных срабатываний детектора по построенной выборке относится к классу задач поиска аномалий. Отличительной особенностью таких задач
является отсутствие примеров отрицательного
класса (ошибки детектора). Сведем данную задачу
к задаче классификации, предложив простую модель распределения ошибочных результатов работы детектора, состоящую из смеси двух распределений.
Первое моделирует случайные ошибки детектора. Для этого используется равномерное распределение обнаружений (их положений и размеров)
по изображению. В качестве второго компонента
смеси взято распределение обнаружений в построенной выборке. Это позволяет алгоритму отличить
обнаружения, характерные для сцен. Эксперименты показали, что наилучшие результаты классификации получаются при смешивании этих распределений в отношении
Для построения классификатора обнаружений
детектора использована нейронная сеть, представленная на рисунке 2. Она состоит из полносвязных
слоев, после которых используется нелинейная
функция ReLu.
Тестирование и оценка
Предложенная сеть обучена на синтетической
выборке, состоящей из 24 143 сцен, с помощью
библиотеки caffe . Скорость обучения понижалась каждые 1 500 итераций с параметром, равным 0,95.
Проведены оценка качества предложенного алгоритма на синтетических и реальных данных, а
также интеграция его с используемым детектором.
Тестирование на синтетических данных. Тестирование проведено на синтетической выборке.
Тестовая выборка состояла из 6 036 различных
сцен, не использованных при обучении. На рисунке 3а показано качество классификации обнаружений на синтетической тестовой выборке.
Тестирование на реальных данных. Для проведения тестирования необходимо знать положение камеры для каждого кадра выборки. Это затрудняет использование стандартных баз размеченных изображений.
Использована выборка TownCentre , так
как она содержит большую часть необходимой информации. К сожалению, параметры положения
камеры, представленные в выборке, оказались неправдоподобными. Это может быть связано с использованием единицы измерения в мировой
системе координат, отличной от метра. В данной
сцене высота камеры над землей приблизительно
равна 8 метрам.
Авторы применили фильтрацию обнаружений
детектора с порогом 0,25. Обнаружение считалось
правильным, если его пересечение с регионом головы человека в разметке занимало не менее 25 %
их объединения. Сравнение качества исходного и
полученного детекторов (рис. 3б) выявило, что
предложенный алгоритм фильтрации позволяет
увеличить точность без существенного уменьшения полноты обнаружения.
Интеграция с детектором
Использовался построенный фильтр обнаружений детектора для ускорения его работы. Действительно, можно оценить, какую область изображе-

ния необходимо обрабатывать на каждом кадре.
Построены маски областей, которые необходимо обрабатывать на каждом уровне пирамиды
изображений для камеры, соответствующей выборке TownCentre (рис. 4, первая строка). Результаты показывают, что в сцене необходимо обработать только небольшое подмножество окон. Например, для сцены TownCentre достаточно обработать
лишь 21,44 % всех окон.
Базовый детектор расширен возможностью обрабатывать только те строки изображения на каждом уровне пирамиды, где правдоподобно обнаружение головы человека. Пример обрабатываемых
областей представлен на рисунке 4 (вторая строка).
Это соответствует обработке 24,03 % всех окон.

Выделение областей интереса является эффективным способом повышения производительности
детектора. Обработка области интереса на сцене
TownCentre позволила повысить скорость обработки данных с 20,03 до 34,36 кадра в секунду.
Полученный результат наиболее важен для систем видеонаблюдения, где параметры камеры
резко изменяются и могут быть оценены один раз.
Заключение
В данной работе представлен эффективный
способ фильтрации обнаружений детектора, основанный на использовании информации о положении камеры.
Предложенный метод позволил повысить точность и скорость работы детектора.
Работа выполнена при поддержке РФФИ, грант
№ 15-31-20596, и Сколковского института науки и технологии, договор № 081-R приложение А2.