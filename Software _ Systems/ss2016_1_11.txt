Особенности применения объектно-ориентированного проектирования встроенных систем жесткого реального времени



Постоянный рост требований к быстродействию управляющих воздействий в сложных многофункциональных системах вызывает необходимость применения в процессе разработки функционального ПО (ФПО) для встроенных систем на кристалле (ВСнК) гибридных методов объектно-ориентированного проектирования (ООП) и языков реализации этих систем, ориентированных на поддержку исполняемых моделей в нотации UML .

Одним из важнейших этапов ООП ФПО, обеспечивающего функционирование ВСнК в режиме реального времени (РВ), является оптимальная по определенным критериям декомпозиция предметной модели системы на взаимодействующие подсистемы . В существующих методологиях в качестве критерия выделения подсистемы используется пространственная обособленность некоторого множества объектов от остальной части проектируемой системы. В настоящее время при создании ВСнК РВ все большее применение находят решения на основе гетерогенных вычислительных платформ, включающих процессорный компонент с различной архитектурой набора команд, с поддержкой вычислений с фиксированной или плавающей запятой и беспроцессорный компонент интеллектуальных функциональных ядер перепрограммируемой логики.

Процессорные элементы гетерогенных вычислительных платформ характеризуются значительными объемами основной и внешней памяти, гибкостью реализуемых алгоритмов управления и форматов данных. Элементы ядер обеспечивают существенно большее быстродействие, разнообразные внешние интерфейсы, обладают сопоставимыми с программируемыми процессорами возможностями адаптации алгоритмов работы к изменяющимся требованиям в процессе функционирования.

В связи с этим при проектировании ФПО РВ актуальность решения задачи декомпозиции на подсистемы, реализуемые программно на процессорных компонентах и на конфигурируемых аппаратных ядрах, очевидна.

Следует учитывать, что подсистемы, реализуемые на языках описания аппаратных средств (HDL), характеризуются низким и практически постоянным временем отклика. В то же время они имеют ограниченные ресурсы по реализации сложных аналитических алгоритмов обработки данных.

Таким образом, сильно связанные объекты, выполняющие задачи принятия решения и управления, потребляющие большие объемы оперативной памяти с требуемым временем реакции, достижимым под управлением ОС РВ, целесообразно выделять в программную подсистему в кодах на языках высокого и низкоуровневого программирования, имплементация которой возлагается на процессор, а объекты, решающие критичные по времени вычислительно сложные задачи (например, цифровая обработка сигналов), выделять в «аппаратную» подсистему, реализуемую на языках HDL в логических блоках ВСнК.

При использовании гетерогенной вычислительной платформы в качестве критериев декомпозиции ФПО на программную и аппаратную подсистемы в процессе ООП следует выбрать требуемое время реакции подсистемы на события, а также требуемую скорость и точность вычислений.

Рассмотрим вариант применения критериев декомпозиции при проектировании распределенной системы управления технологическим процессом (ТП) РВ, представленной на рисунке 1.

Подсистема формирования задач управления (ПФЗУ) периодически формирует блоки данных заданий для подсистемы формирования сигналов управления (ПФСУ), являющейся объектом проектирования. При этом ПФЗУ использует модели функционирования объекта управления, которым является ТП РВ, а формируемые задачи сформулированы в параметрах и величинах предметной области. Во временной области функциональные задачи привязаны к единому времени, которое отсчитывается по двум синхронизированным шкалам: T с периодом порядка единиц миллисекунд (формирование заданий управления) и D с периодом порядка единиц микросекунд (формирование управляющих сигналов для ТП РВ).

ПФСУ является встроенной вычислительной системой, пространственно отдаленной от ПФЗУ и ТП РВ. Аппаратные средства ВСнК включают в себя универсальные 32-разрядные целочисленные RISC-процессоры средней мощности и блоки программируемой логики.

Поступающие в соответствии с синхронизирующими импульсами шкалы T задания управления подвергаются дополнительной обработке, заключающейся в формировании последовательностей управляющих сигналов на основе параметров задания. Данный этап должен быть завершен до поступления следующего импульса шкалы времени T. Поскольку время обработки одного задания на имеющихся аппаратных средствах сопоставимо с длительностью периода синхросигнала шкалы T, время реакции на поступление задания от ПФЗУ должно быть на порядок меньше этого периода и составлять сотни микросекунд. Последовательности управляющих сигналов выдаются ТП РВ в соответствии с импульсами синхросигнала шкалы D. Таким образом, время реакции ПФСУ на импульсы синхронизации D должно быть на порядок меньше периода данной шкалы, то есть составлять не более сотен наносекунд.

В качестве критерия декомпозиции проектируемого элемента на программную и аппаратную подсистемы используется требуемое время реакции на события, которыми являются фронты синхросигналов временных шкал T и D.

Подсистема элемента ПФСУ, реализуемая как программа для процессорного ядра, функционирует под управлением ОС РВ на основе Linux; задачи, использующие дисциплину планирования FIFO, под ее управлением обладают временем отклика от нескольких десятков до нескольких сотен микросекунд. Таким образом, программный компонент использует только синхросигналы шкалы T. Результат выполнения декомпозиции ПФСУ на компоненты формирования управляющих последовательностей (ФУП) и выдачи управляющих последовательностей (ВУП) приведен на рисунке 2.

Компонент ФУП включает в себя активный объект «Формирователь», который исполняется как задача с низким приоритетом и осуществляет формирование массивов управляющих сигналов, соответствующих поступающим от ПФЗУ заданиям. Активный объект «Планировщик», в свою очередь, исполняется как задача с высоким приоритетом и осуществляет передачу аппаратным средствам массивов управляющих сигналов в течение периода синхросигнала шкалы T, предшествующего периоду исполнения управления.

Компонент ФУП состоит из двойного буфера, каждая часть которого хранит массив управляющих сигналов на один период шкалы T, и активного объекта «Автомат выдачи», представляющего собой конечный автомат, диаграмма состояний которого приведена на рисунке 3. 

Событиями, вызывающими изменения состояния автомата, являются синхросигналы шкал T и D, а дополнительными условиями – состояния частей двойного буфера.

Обобщенные состояния S1 и S2 связаны с использованием в работе соответственно первой и второй половин двойного буфера управляющих сигналов. Состояния W1 и W2 связаны с ожиданием поступления данных от компонента ФУП, а состояния V1 и V2 – с последовательной выдачей управляющих сигналов ТП РВ под управлением синхронизирующих импульсов шкалы D.

На рисунке 4 изображена временная диаграмма функционирования ПФСУ. Параллельное выполнение активных объектов подсистемы обеспечивает совмещение по времени различных стадий обработки поступающих задач управления и режим работы подсистемы, аналогичный вычислительному конвейеру.

Интервал шкалы T от импульса 2 до 3 характеризуется максимальным использованием ресурсов встроенной вычислительной системы. В течение этого периода высокоприоритетный «Планировщик» инициирует передачу аппаратным средствам массива управляющих сигналов З2, сформированного в предыдущем периоде. При этом фактическую запись управляющих последовательностей в свободную часть двойного буфера компонента ВУП производит контроллер прямого доступа к памяти (DMA), что освобождает процессор для работы низкоприоритетного «Формирователя» на большую часть периода. Одновременно автомат выдачи компонента ВУП осуществляет исполнение управляющей последовательности З1, сформированной в течение периода 0 и записанной в соответствующую часть буфера в течение периода 1. При планировании задач формирователя и планировщика в ОС РВ с использованием алгоритма монотонных частот условие выполнения временных ограничений системой определяется теоремой о верхней границе использования процессора, где Сф – время выполнения одного цикла задачи формирователя (обработки одного задания); Сп – время выполнения одного цикла задачи планировщика (выдачи аппаратным средствам одной управляющей последовательности); Т – период синхросигнала шкалы Т.

Предлагаемый метод декомпозиции ФПО ВСнК позволяет успешно реализовать требования режима реального времени при управлении многофункциональными системами.

