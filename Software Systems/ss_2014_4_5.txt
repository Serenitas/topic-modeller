
Для подготовки операторов сложных технических систем используются  технические средства, отвечающие требованиям методик подготовки, реализующие модель таких систем и обеспечивающие контроль за действиями обучаемого.
Кроме формирования индивидуальных профессиональных навыков и умений, ТОС могут применяться для отработки групповых операций и для исследований [1].
Подсистема визуализации обеспечивает отображение результатов моделирования внешней среды и объекта управления с помощью устройств отображения информации.
Мультимедийные технологии при построении ТОС позволяют создавать банки данных учебных материалов, содержащие изображения, тексты, сопровождающиеся аудио, видео и другими визуальными эффектами, включают в себя интерактивный интерфейс и дают возможность эффективно использовать накопленную информацию при организации дистанционного и распределенного обучения [2].
Одним из видов мультимедийной информации, использующейся в ТОС, является графический виртуальный образ инструктора [3].
Для его внедрения в единое синтезированное трехмерное окружение создан метод рирпроекции, базирующийся на методе 3D-кеинга.
Основной идеей технологии кеинга является выделение объекта от однородного фона.
Данный процесс можно описать как процесс создания маски, содержащей информацию о прозрачности изображения и отделяющей объект от остального изображения.
В компьютерной графике маска является изображением с одним каналом, используемым для определения прозрачных областей переднего плана и фона на скомбинированном изображении.
Маску прозрачности часто называют альфа-каналом [4].
Создание качественной маски прозрачности трудоемкая задача.
Наиболее простым решением является создание маски, которая делает фон изображения полностью прозрачным, а объекты переднего плана абсолютно видимыми.
Однако такой подход неприменим для сложных сцен: объекты переднего плана будут иметь резкие края и, соответственно, выглядеть нереалистично.
Существует несколько подходов для выделения объектов от фона.
Наиболее распространенным является использование однородного фона, например синего или зеленого.
Недостатком этого подхода является необходимость точной калибровки света для получения однородного фона.
Еще один подход состоит в использовании нескольких изображений, на которых присутствует объект для выделения.
Однако данный подход требует строгих условий съемки и применим только для статических объектов.
Третий подход основывается на том, что объекты фона и переднего плана заранее известны.
Пользователь выделяет объекты на переднем плане и фоне, а оставшаяся часть изображения границы объекта на переднем плане считается зоной перехода.
Данный подход не может использоваться в реальном масштабе времени, соответственно, неприменим для подсистемы визуализации ТОС [5].
Проведем анализ существующих методов рирпроекции с целью определения возможности их использования в ТОС.
Существует большое количество методов кеинга, каждый со своими достоинствами и недостатками.
Одним из наиболее простых является люма-кеинг .
Так как большинство видеосигналов  предоставляют информацию о яркости изображения отдельно от информации о цвете, задача создания маски прозрачности на основе яркости является достаточно простой.
Если изображение представлено в цветовом пространстве RGB, целесообразно приведение цвета к цветовой модели HLS  для получения яркостной составляющей.
Установив пороговое значение яркости, можно создать простую маску прозрачности, определяющую видимость пикселя полностью видим или полностью невидим.
Более совершенные методы люма-кеинга позволяют определять значения мягкости и допустимого предела.
Мягкость описывает переход от полностью видимого пикселя к невидимому .
Допустимый предел описывает диапазон значений вокруг заданного значения яркости.
Параметры мягкости и допустимого предела применяются и в других видах кеинга.
Из-за отсутствия возможности использовать информацию о цвете изображения люма-кеинг неприменим для большинства ситуаций, однако может найти применение для таких работ, как извлечение текста  [6].
Другим методом кеинга является так называемый хромакеинг .
Под хромакеингом подразумевается процесс создания маски прозрачности на основе цветовой информации изображения, в то время как информация о яркости и насыщенности не используется.
Изображения объектов, снятых на более-менее однородном синем или зеленом фоне, можно выделить, используя только цветовую информацию.
Однако обеспечить полностью однородный фон у изображения (в том числе из-за особенностей освещения) невозможно.
Из-за этого маска создается путем задания предельно допустимого значения по цвету для выбранного значения цвета.
Если значение пикселя находится в допустимых пределах, значение маски пикселя п устанавливается в 1, иначе 0:  Следовательно, хромакеинг может быть осуществлен с использованием любого выбранного цвета фона.
Однако качество хромакеинга обычно невысокое, особенно в случае сжатия изображения.
Хромакеинг сжатого изображения приведет к созданию маски худшего качества, чем несжатого.
Метод хромакеинга может быть улучшен путем добавления таких параметров, как оттенок и яркость изображения, а также их предельно допустимых значений.
Несмотря на то что у HLS-кеинга есть такие недостатки, как острые грани, для смягчения которых требуется размытие или другие техники обработки граней, существует несколько приложений, использующих HLS-кеинг.Например, компания Autodesk предоставляет два модуля HLS-кеинга в своем ПО для монтажа Combustion: Discreet Keyer и Diamond Keyer.
На сегодняшний день термин хромакеинг используется для многочисленных методов выделения объектов переднего плана от фона изображения, которые не являются хромакеингом в первоначальном смысле этого слова.
Причиной можно считать то, что изображение в цифровом формате представляется в цветовой модели RGB.
Алгоритмы кеинга, работающие с изображением напрямую в цветовой модели RGB, используют информацию трех цветовых каналов, а не информацию о яркости или насыщенности изображения.
Примером кеинга, работающего в цветовом пространстве RGB, может являться методика определения различий между цветами.
Данный метод был предложен Петро Влахосом в 1964 году.
Изначально метод был разработан для химической и оптической обработки цвета отснятой кинопленки.
Основной идеей определения различий между цветами изображения является определение значения прозрачности на основе разности между цветовыми каналами R, G и B.
Еще одним методом кеинга является 3D-кеинг.В 3D-кеинге маска прозрачности создается с использованием поверхностей и трехмерных объектов для отделения фоновых пикселей от остального изображения.
Изображение представляется в виде точек определенного цвета  в трехмерном пространстве RGB или HLS.
Одним из простейших объектов, определяющих границы цветов, является сфера.
Поместим сферу в пространстве так, чтобы она перекрывала облако цветов фона, то есть определяла диапазон значений цвета, которые будут считаться полностью прозрачными.
Координаты этой сферы могут быть заданы автоматически на основе анализа цветов изображения либо вручную указаны пользователем.
Для получения плавной зоны перехода создается вторая сфера большего радиуса, центр которой располагается в той же точке, что и центр первой сферы.
Как показано на рисунке 1, пиксели, расположенные внутри сферы, являются полностью прозрачными, пиксели, находящиеся вне сферы, полностью видимыми, а пиксели, находящиеся между границами сфер и, полупрозрачными.
Значения прозрачности рассчитываются на основе координат пикселя в трехмерном пространстве и центра сфер либо поверхностей и.
Практически любой тип трехмерного объекта может быть использован для отделения цвета фона от цвета объектов переднего плана, однако в большинстве случаев применяются выпуклые каркасы .
Соответственно, необходимо, чтобы пользователь выделил несколько пикселей фона с целью их перекрытия выпуклым каркасом.
Существуют два приложения на рынке, выполняющих 3D-кеинг при помощи трехмерных поверхностей: Primatte Keyer компании Imagica и Modular Keyer компании discreet/autodesk.
Они различаются типом применяемых трехмерных объектов и алгоритмом взаимодействия с пользователем.
Известны и другие методы кеинга, которые требуют использования специального оборудования для захвата дополнительных данных, используемых для создания маски прозрачности.
Так, один из методов подразумевает использование поляризованного света, который, отражаясь от кожи или поверхностей, становится неполяризованным, однако специальный материал фона отражает поляризованный свет.
Разница в отраженном сигнале используется для создания маски прозрачности.
Преимуществом данного подхода является независимость цвета объекта переднего плана от цвета фона.
Нет необходимости как в точной настройке света для того, чтобы избежать получения определенных цветов на объекте переднего плана, так и в постобработке изображения для удаления засветки объекта переднего плана цветом фона.
Недостатком данного метода являются значительные финансовые затраты на отражающий материал и оборудование для записи и обработки поляризованного сигнала.
Другой метод использует инфракрасное излучение для расчета дистанции каждого пикселя до камеры, поэтому он называется Z-кеингом.
Используя информацию о глубине изображения, можно задать определенную границу и выделять только те объекты, которые соответствуют заданным параметрам глубины [7].
Еще один метод кеинга использует информацию о температуре объектов и создает маску прозрачности путем отделения холодных участков изображения от теплых [8].
Недостатком этого метода является то, что только живые или теплые объекты будут представлены как объекты переднего плана, в то время как некоторые детали, такие как волосы, не будут правильно вырезаны из фонового изображения [9].
Проанализировав существующие методы рирпроекции, можно создать сводную таблицу функциональности.
Проведенный анализ показывает ряд преимуществ 3D-кеинга перед другими методами рирпроекции и возможность его применения в ТОС.
Метод кеинга, реализованный в подсистеме визуализации ТОС, базируется на методе 3D-кеинга [10].
Даже использование современных многоядерных процессоров для выполнения кеинга не гарантирует существенного увеличения скорости обработки.
На сегодняшний день производительные многоядерные процессоры состоят из 812 ядер и способны одновременно обрабатывать от одного до четырех  пикселей изображения на каждом ядре.
Современные видеокарты состоят из тысяч шейдерных процессоров, способных одновременно обрабатывать пиксели изображения.
Учитывая данное обстоятельство, было принято решение использовать вычислительные мощности графического процессора для реализации кеинга.
Кеинг реализован в виде шейдера посредством языка GLSL и выполняется при помощи видеокарты.
Обработка производится для каждого пикселя изображения.
Пиксели изображения представляются в цветовой модели RGB, в то время как компонент используется для определения прозрачности пикселя.
Первой проверкой является сравнение компонентов цвета пикселя друг с другом.
Каждая компонента цвета представляется в диапазоне от 0 до 255.
В зависимости от настроек параметров алгоритма происходит выбор базовой компоненты, доминирующей в фоне обрабатываемого изображения.
Рассмотрим случай, когда базовой является компонента зеленого цвета .
По вышеуказанному критерию данный пиксель будет считаться не принадлежащим к объектам переднего плана, что неверно.
Одним из способов повышения точности выбора пикселей с преобладающей зеленой компонентой является введение параметра дистанции.
 На рисунке 2 изображен RGB-куб, содержащий усеченную пирамиду OGYWC.
Для каждой точки внутри пирамиды с координатами RGB выполняется условие G R и G B.
На рисунке 3 приведена усеченная пирамида OGYWC, пересеченная плоскостью, параллельной диагонали OW.
Необходимо отметить, что уравнение  применимо только для точек, расположенных внутри усеченной пирамиды .
Положение плоскости определяется значением параметра.
Для каждого пикселя изображения производится расчет значения и маска прозрачности строится на основе сравнения значений и.
Генерируемая маска прозрачности позволяет задавать частичную прозрачность пикселя изображения.
При объединении обработанного кеингом изображения с изображением, генерируемым подсистемой визуализации, итоговый пиксель будет являться линейной интерполяцией цвета пикселей двух изображений, а рассчитанное значение будет выступать в качестве параметра.
Использование частичной прозрачности позволяет добиться плавного перехода между объектами переднего плана и фоновым изображением, генерируемым подсистемой визуализации.
На основе параметров, и параметра мягкости  рассчитывается значение для конкретного пикселя.
Формула расчета значения основана на линейной интерполяции значений.
Функция расчета возвращает значение в отрезке [0:1] .
В OpenGL цвет представляется в виде значений от 0 до 1, а не от 0 до 255.
Описанный метод не учитывает наличие отраженного света от фона на объектах переднего плана.
Например, в области попадания отраженного света значение зеленой компоненты оказывалось меньше, чем значение красной компоненты, соответственно, такой пиксель признавался принадлежащим к объектам переднего плана.
Такие цвета близки к светло-желтому, поэтому хорошо заметны на коже актера.
Для преодоления данной проблемы была введена цветокоррекция.
Пользователь выставляет пороговые значения, на основе которых алгоритм проверяет необходимость выполнения цветокоррекции для данного пикселя.
Если значение зеленой компоненты превышает или равно значению красной компоненты минус первое пороговое значение, задаваемое пользователем, и значение зеленой компоненты равно или превышает значение синей компоненты плюс второе пороговое значение, задаваемое пользователем, то значение зеленой компоненты данного пикселя будет изменено на значение, лежащее в середине отрезка между значениями красной и синей компонент пикселя.
Таким образом, для использования графического виртуального образа инструктора в виртуальном трехмерном окружении ТОС были решены следующие задачи: разработан метод кеинга в виртуальном трехмерном окружении и реализован кеинг с использованием вычислительных мощностей графического процессора с незначительным, по сравнению с реализацией кеинга на центральном процессоре, снижением производительности подсистемы визуализации.
Кроме того, введена цветокоррекция для устранения отраженного света от фона на объектах переднего плана.
There is a need of a massive increase of training centers efficiency, particularly with adaption of new training methods and developing of more effective training complexes.
Using multimedia technologies in training-simulation systems development allows creating training materials data banks that include images, texts accompanied by audio, video and visual effects, interactive interface; provide an effective way of using collected information for distant and distributed training.
One way of using multimedia data in training simulation systems is to insert a graphical representation of instructor into virtual environment.
In order to correctly visualize an image of instructor in a 3D virtual scene a method of rear-projection has been developed.
It is based on 3D keying.
Its main function is to separate an object from a uniform background.
This process can be described as a process of creating a mask that contains information about image translucency that separates an object from other parts of an image.
Any keying method is resource-intensive, so processing of large images on CPU can lead to performance problems of visualization subsystem, while one of the requirements for visualization subsystem is real-time operation.
Considering this requirement, a realization of keying algorithm uses resources of the video card to process images.
1.
Reshetnikov V.N.
[Space communications ].
2.
Mamrosenko K.A.
The regulatory base to design aerospace training systems.
2013, no.
4, pp.
3.
Giatsintov A.M.
Playback of heterogeneous videos on 3d objects edges in visualization subsystem of training simulation system.
2012, no.
3, pp.
4.
Bill Schnarr..
5.
Application of virtual reality technologies in simulation complexes for cosmonaut training.
[Space Manned Missions].
2013, no.
6..
7..
8..
9.
Schultz Ch..
Germany, Univ.
10.
Software chroma keying in an immersive virtual environment..
1999, no.
24, pp.
155162.
